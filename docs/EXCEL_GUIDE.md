# Excel文件查看指南

## 📋 文件位置
```
data/backtest/trades/hot_rank_top10_open_v1.0.0_02ce30f3_20260105_222721_trades.xlsx
```

## 🎨 Excel格式说明

### 1. 表头（第一行）
- **深蓝色背景** (#366092)
- **白色粗体文字**
- 居中对齐
- 滚动时自动固定在顶部

### 2. 数据行
- **奇数行**：白色背景
- **偶数行**：浅灰色背景 (#F2F2F2)
- 自动交替，方便阅读

### 3. 盈亏高亮（net_pnl列）
- **盈利**：<span style="color:#00AA00">**绿色粗体**</span>
- **亏损**：<span style="color:#FF0000">**红色粗体**</span>
- 一眼就能看出每笔交易的盈亏情况

### 4. 其他格式
- 所有单元格都有浅灰色边框
- 列宽自动调整（根据内容）
- 文字左对齐、垂直居中

## 📊 关键字段说明

| 字段名 | 说明 | 示例 |
|--------|------|------|
| `code` | 股票代码 | 600579 |
| `name` | 股票名称 | 天华超净 |
| `entry_date` | 买入日期 | 2025-01-03 |
| `rank_t1` | **T-1日人气排名**（买入依据） | 10 |
| `rank_t` | **T日人气排名**（买入当日） | 8 |
| `rank_t_plus_1` | **T+1日人气排名**（通常为卖出日） | 153 |
| `buy_exec` | 实际买入价格（含滑点） | 88.46 |
| `buy_shares` | 买入股数 | 100 |
| `buy_cost` | 买入总成本（含手续费） | 8850.83 |
| `exit_date` | 卖出日期 | 2025-01-06 |
| `exit_reason` | 退出原因 | not_limit_up_and_rank_drop |
| `sell_exec` | 实际卖出价格 | 73.97 |
| `net_pnl` | **净盈亏**（扣除所有成本） | -1250.83 |
| `net_pnl_pct` | **净收益率** | -14.14% |
| `hold_days` | 持仓天数 | 2 |

## 🔍 使用技巧

### 1. 快速筛选盈利/亏损交易
1. 点击表头的筛选按钮（小三角）
2. 在 `net_pnl` 列选择：
   - "大于0" → 查看所有盈利交易
   - "小于0" → 查看所有亏损交易

### 2. 按人气排名排序
1. 点击 `rank_t1` 列的筛选按钮
2. 选择"升序"或"降序"
3. 可以看到不同排名的交易表现

### 3. 查看特定股票的所有交易
1. 点击 `code` 列的筛选按钮
2. 输入股票代码（如"600579"）
3. 查看该股票的历史交易记录

### 4. 计算统计指标
在Excel中可以使用公式：
```excel
# 总盈亏
=SUM(M:M)  # M列是net_pnl

# 平均盈亏
=AVERAGE(M:M)

# 胜率
=COUNTIF(M:M,">0")/COUNT(M:M)

# 最大盈利
=MAX(M:M)

# 最大亏损
=MIN(M:M)
```

### 5. 创建数据透视表
1. 选中所有数据（Ctrl+A）
2. 插入 → 数据透视表
3. 可以按日期、排名、退出原因等维度分析

### 6. 绘制盈亏分布图
1. 选中 `entry_date` 和 `net_pnl` 两列
2. 插入 → 折线图
3. 可以看到累计盈亏曲线

## 💡 常见问题

### Q1: 为什么有些盈亏是负数但显示为绿色？
A: 不会出现这种情况。代码逻辑确保只有正数显示绿色，负数显示红色。

### Q2: 如何还原原始格式？
A: 直接重新从 `data/backtest/trades/` 目录打开Excel文件即可。

### Q3: CSV和Excel内容一样吗？
A: 内容完全一样，只是Excel增加了格式化（颜色、边框等），方便查看。

### Q4: 可以修改Excel中的数据吗？
A: 可以，但建议不要修改。如需重新分析，请重新运行回测脚本。

### Q5: 为什么rank_t_plus_1有时是None？
A: 极少数情况下，卖出日可能没有人气排名数据（如股票停牌），会显示为None。

## 📖 退出原因解释

| 原因代码 | 含义 |
|---------|------|
| `not_limit_up` | 次日收盘未涨停（但人气排名仍在前50） |
| `not_limit_up_and_rank_drop` | 次日收盘未涨停 **且** 人气排名跌破50 |

---

**提示**：如果Excel打开时提示"文件格式或扩展名无效"，请确保使用Excel 2007或更高版本。
