# A股数据字段说明

## 数据源
- **数据提供商**: AkShare
- **数据接口**: `stock_zh_a_hist()`
- **更新频率**: 日线数据（每个交易日）

## 标准字段

下载的 Parquet 文件包含以下标准化字段：

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `date` | date | 交易日期 | 2025-12-31 |
| `code` | string | 股票代码（6位） | 000001 |
| `name` | string | 股票名称 | 平安银行 |
| `open` | float | 开盘价（元） | 11.45 |
| `high` | float | 最高价（元） | 11.58 |
| `low` | float | 最低价（元） | 11.32 |
| `close` | float | 收盘价（元） | 11.41 |
| `volume` | int64 | 成交量（手，1手=100股） | 590620 |
| `amount` | float | 成交额（元） | 67438912.0 |
| `turnover` | float | 换手率（%） | 0.94 |
| `hot_rank` | int | 股票热度排名 | 489 |
| `new_fans_pct` | float | 新晋粉丝占比（0-1） | 0.3237 |
| `core_fans_pct` | float | 铁杆粉丝占比（0-1） | 0.6763 |

## 字段详细说明

### 1. date (交易日期)
- **格式**: YYYY-MM-DD
- **说明**: 该记录对应的交易日
- **注意**: 只包含交易日，不包含周末和节假日

### 2. code (股票代码)
- **格式**: 6位数字字符串
- **范围**: 
  - 上海主板: 600xxx, 601xxx, 603xxx, 605xxx
  - 深圳主板: 000xxx, 001xxx
  - 创业板: 300xxx
  - 科创板: 688xxx
  - 北交所: 4xxxxx, 8xxxxx
- **示例**: 
  - 平安银行: 000001
  - 贵州茅台: 600519
  - 宁德时代: 300750

### 3. name (股票名称)
- **格式**: 中文字符串
- **说明**: 股票的中文简称
- **数据源**: 东方财富股票列表API (`stock_zh_a_spot_em()`)
- **示例**:
  - 000001: 平安银行
  - 600519: 贵州茅台
  - 300750: 宁德时代
- **注意**: 
  - 名称随公司更名可能变化
  - 历史数据使用获取时的名称，不会追溯更新

### 4. open, high, low, close (价格)
- **单位**: 元（人民币）
- **精度**: 通常保留2位小数
- **复权处理**: 
  - 配置 `adjust: "qfq"` - 前复权价格（默认）
  - 配置 `adjust: "hfq"` - 后复权价格
  - 配置 `adjust: ""` - 不复权（原始价格）
- **说明**:
  - `open`: 当日开盘价
  - `high`: 当日最高价
  - `low`: 当日最低价
  - `close`: 当日收盘价

### 4. volume (成交量)
- **单位**: 手（1手 = 100股）
- **类型**: 整数
- **说明**: 当日总成交量
- **换算**: 实际成交股数 = volume × 100

### 5. amount (成交额)
- **单位**: 元（人民币）
- **说明**: 当日总成交金额
- **计算**: 约等于成交价格 × 成交量

### 6. turnover (换手率)
- **单位**: 百分比（%）
- **说明**: 成交量占流通股本的比例
- **计算**: (成交量 / 流通股本) × 100%
- **用途**: 衡量股票流动性和市场活跃度
- **数据源**: AkShare `stock_zh_a_hist()` 接口的"换手率"字段

### 7. hot_rank (股票热度排名) **[可选字段]**
- **单位**: 排名序号（整数）
- **说明**: 当日该股票在所有A股中的热度排名
- **数值**: 数字越小表示越热门（如：1 = 最热门）
- **数据源**: 东方财富股吧 API (`stock_hot_rank_detail_em()`)
- **覆盖范围**: 近一年历史数据（~366天）
- **配置**: 需在 `config.yaml` 中设置 `enable_popularity: true`
- **用途**: 
  - 衡量股票的市场关注度和热度
  - 识别短期热点股票
  - 结合价格分析预测市场情绪
- **注意**: 
  - 并非所有日期都有热度数据
  - 新股或冷门股可能无排名数据
  - 排名受东方财富股吧社区活跃度影响

### 8. new_fans_pct (新晋粉丝占比) **[可选字段]**
- **单位**: 小数（0-1之间）
- **说明**: 当日新增关注该股票用户的比例
- **示例**: 0.3237 表示 32.37% 为新晋粉丝
- **数据源**: 东方财富股吧 API
- **覆盖范围**: 近一年历史数据
- **配置**: 需在 `config.yaml` 中设置 `enable_popularity: true`
- **用途**:
  - 衡量股票的新鲜关注度
  - 新晋粉丝占比高通常表示该股票近期吸引新资金关注
  - 可作为市场情绪变化的领先指标
- **关系**: `new_fans_pct + core_fans_pct = 1.0`

### 9. core_fans_pct (铁杆粉丝占比) **[可选字段]**
- **单位**: 小数（0-1之间）
- **说明**: 长期关注该股票用户的比例
- **示例**: 0.6763 表示 67.63% 为铁杆粉丝
- **数据源**: 东方财富股吧 API
- **覆盖范围**: 近一年历史数据
- **配置**: 需在 `config.yaml` 中设置 `enable_popularity: true`
- **用途**:
  - 衡量股票的稳定关注度
  - 铁杆粉丝占比高通常表示该股票有稳定的投资者群体
  - 可作为股票稳定性和投资者信心的指标
- **关系**: `new_fans_pct + core_fans_pct = 1.0`

## 数据质量保证

### 自动校验
脚本会自动进行以下检查：

1. **去重**: 按 (code, date) 去除重复记录
2. **空值检测**: 检查关键字段是否有空值
3. **负价格检测**: 价格字段不应为负数
4. **数据完整性**: 确保必需字段都存在

### 数据异常处理
- **停牌数据**: 如果股票停牌，该日期可能无数据
- **新股上市**: 上市日期之前无数据
- **退市股票**: 退市后不再更新

## 查看数据示例

### 使用 Python Pandas
```python
import pandas as pd

# 读取所有数据
df = pd.read_parquet('data/parquet/ashare_daily/**/*.parquet')
print(df.head())
print(df.info())
```

### 使用 DuckDB
```python
import duckdb

con = duckdb.connect()
df = con.execute("""
    SELECT * 
    FROM read_parquet('data/parquet/ashare_daily/**/*.parquet')
    WHERE code = '000001'
    ORDER BY date DESC
    LIMIT 10
""").df()
print(df)
```

### 使用查看脚本
```bash
python view_data.py
```

## 常见问题

### Q: 为什么有些日期缺失？
A: 周末和法定节假日不是交易日，数据中不会包含这些日期。

### Q: 成交量单位是什么？
A: 成交量单位是"手"，1手=100股。例如成交量为1000，表示实际成交了100,000股。

### Q: 前复权和后复权有什么区别？
A: 
- 前复权(qfq): 保持当前价格不变，调整历史价格
- 后复权(hfq): 保持历史价格不变，调整当前价格
- 不复权: 原始价格，不考虑分红送股

### Q: 数据更新频率？
A: 数据源通常在交易日收盘后更新，建议每天收盘后运行增量更新脚本。

### Q: 如何计算市值？
A: 需要额外获取股本数据。市值 = 收盘价 × 总股本

## 扩展字段

AkShare 原始数据还包含以下字段（未在标准输出中包含）：

- `amplitude`: 振幅（%）
- `pct_change`: 涨跌幅（%）
- `change`: 涨跌额（元）
- `turnover`: 换手率（%）

如需这些字段，可以修改 `scripts/download_ashare_3y_to_parquet.py` 中的 `required_cols` 列表。
