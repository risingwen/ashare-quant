# 资金分10份策略回测总结

## 📊 回测结果概览

### 基本信息
- **回测周期**: 2025-01-02 至 2025-12-31 (约243个交易日)
- **初始资金**: 100,000元
- **资金分配**: 10份，每份约10,000元
- **最大持仓**: 10只股票
- **最终净值**: 107,992.21元
- **总收益**: +7,992.21元
- **总收益率**: **+7.99%**

### ⚡ 核心指标

| 指标 | 数值 |
|------|------|
| 交易笔数 | 1,109笔 |
| 盈利笔数 | 464笔 (41.8%) |
| 亏损笔数 | 645笔 (58.2%) |
| 平均持仓天数 | 2.19天 |
| 平均单笔收益率 | +0.08% |
| 盈利交易平均收益 | +804.70元 (+8.88%) |
| 亏损交易平均亏损 | -566.50元 (-6.25%) |
| 盈亏比 | 1.42 |
| 最大单笔收益 | +11,139.18元 (+117.93%) |
| 最大单笔亏损 | -2,490.04元 (-25.20%) |

## 📈 与之前策略的对比

### 资金分2份 vs 资金分10份

| 维度 | 资金分2份（每份5万） | 资金分10份（每份1万） | 改善 |
|------|---------------------|---------------------|------|
| **总收益率** | -55.69% | **+7.99%** | **+63.68%** ✅ |
| 交易笔数 | 69笔 | 1,109笔 | +1040笔 |
| 胜率 | 36.2% | 41.8% | +5.6% |
| 平均持仓天数 | 2.01天 | 2.19天 | +0.18天 |
| 盈亏比 | 0.92 | 1.42 | +54% |
| 最大单笔亏损 | -17.55% | -25.20% | 风险略增 |

### 💡 核心发现

1. **分散持仓效果显著**：
   - 从亏损55.69%到盈利7.99%，完全扭转了策略的表现
   - 通过持有更多股票，大幅降低了单一股票暴跌的风险

2. **交易机会大幅增加**：
   - 交易笔数从69笔增加到1,109笔（增长16倍）
   - 能够更充分地捕捉TOP10人气股的机会

3. **盈亏比改善**：
   - 盈亏比从0.92提升到1.42
   - 平均盈利幅度（8.88%）明显大于平均亏损幅度（6.25%）

## 📋 人气排名分布分析

### 买入时人气排名分布（T-1日）

| 排名 | 交易笔数 | 占比 |
|------|----------|------|
| rank=10 | 209笔 | 18.8% |
| rank=9  | 193笔 | 17.4% |
| rank=8  | 180笔 | 16.2% |
| rank=7  | 164笔 | 14.8% |
| rank=6  | 129笔 | 11.6% |
| rank=5  | 102笔 | 9.2% |
| rank=4  | 64笔  | 5.8% |
| rank=3  | 39笔  | 3.5% |
| rank=2  | 20笔  | 1.8% |
| rank=1  | 9笔   | 0.8% |

**分析**：优先买入排名靠后的策略生效，209笔交易是rank=10的股票。

### 退出原因统计

| 退出原因 | 笔数 | 占比 |
|----------|------|------|
| not_limit_up_and_rank_drop | 584笔 | 52.7% |
| not_limit_up | 525笔 | 47.3% |

**分析**：52.7%的交易因人气衰退而退出，说明排名靠后的股票确实更容易跌出前50名。

## ✅ 新增功能实现

### 1. 资金分10份
- ✅ 配置文件已修改：`cash_splits: 10`
- ✅ 最大持仓：10只股票
- ✅ 每笔交易：约10%初始资金

### 2. 人气排名字段
所有交易记录现在包含完整的人气排名信息：

| 字段 | 说明 | 完整率 |
|------|------|--------|
| `rank_t1` | T-1日人气排名（买入决策依据） | 100% |
| `rank_t` | T日（买入日）人气排名 | 100% |
| `rank_t_plus_1` | T+1日人气排名（通常为卖出日） | 100% |
| `rank_exit` | 卖出日人气排名 | 100% |

### 3. 格式化Excel输出

生成的Excel文件特性：
- ✅ **表头格式化**：深蓝色背景 + 白色粗体文字
- ✅ **交替行颜色**：灰白相间，易于阅读
- ✅ **盈亏上色**：
  - 盈利显示为 <span style="color:green">**绿色粗体**</span>
  - 亏损显示为 <span style="color:red">**红色粗体**</span>
- ✅ **自动列宽**：根据内容自动调整
- ✅ **冻结首行**：滚动时表头始终可见
- ✅ **单元格边框**：灰色细线边框

**文件位置**：
```
data/backtest/trades/hot_rank_top10_open_v1.0.0_02ce30f3_20260105_222721_trades.xlsx
```

**文件大小**：约217KB

## 🎯 策略优化建议

### 当前策略的优势
1. ✅ 分散风险效果显著
2. ✅ 交易机会充足（1109笔）
3. ✅ 盈亏比健康（1.42）
4. ✅ 实现了正收益（+7.99%）

### 可进一步优化的方向

#### 1. 动态仓位管理
```yaml
# 当前：固定10份
# 建议：根据市场环境动态调整
- 强势市场：5-8份（每份1.25-2万）
- 震荡市场：10份（当前配置）
- 弱势市场：15-20份（每份5000-6667元）
```

#### 2. 选择性买入
```python
# 不是所有rank=10的都买入，增加过滤条件：
- 要求T-1日涨幅 > 3%（确认热度）
- 要求T-1日成交额 > 5亿（流动性保证）
- 排除连续多日上涨的股票（避免追高）
```

#### 3. 更灵活的卖出规则
```python
# 当前：次日不涨停 OR 人气跌破50就卖
# 建议：分层卖出
- 盈利 > 10%：保护性止盈，跌破当日最高价5%就卖
- 盈利 0-10%：当前规则保持
- 亏损 > 5%：立即止损
```

#### 4. 加入时间过滤
```python
# 避开不利时段：
- 月末、季末（资金面紧张）
- 长假前（避险情绪）
- 开盘前15分钟和尾盘最后15分钟（波动大）
```

## 📁 输出文件说明

### 1. Parquet文件（程序读取用）
```
data/backtest/trades/hot_rank_top10_open_v1.0.0_02ce30f3_20260105_222721_trades.parquet
```
- 用于程序化分析
- 体积小，读取快
- 保留完整数据类型

### 2. CSV文件（通用格式）
```
data/backtest/trades/hot_rank_top10_open_v1.0.0_02ce30f3_20260105_222721_trades.csv
```
- UTF-8编码（带BOM）
- Excel/Python均可打开
- 纯文本，兼容性最好

### 3. **Excel文件（推荐查看）** ⭐
```
data/backtest/trades/hot_rank_top10_open_v1.0.0_02ce30f3_20260105_222721_trades.xlsx
```
- **推荐使用**：格式化良好，直接用Excel打开即可查看
- 包含颜色、边框、对齐等格式
- 盈亏一目了然

## 🛠️ 使用说明

### 查看回测结果
1. **Excel方式（推荐）**：
   ```
   直接打开：data/backtest/trades/*_trades.xlsx
   ```

2. **Python方式**：
   ```python
   import pandas as pd
   df = pd.read_csv('data/backtest/trades/*_trades.csv')
   # 或
   df = pd.read_parquet('data/backtest/trades/*_trades.parquet')
   ```

### 重新运行回测
```bash
python scripts/backtest_hot_rank_top10_open_strategy.py \
  --config config/strategies/hot_rank_top10_open.yaml
```

### 修改配置
编辑 `config/strategies/hot_rank_top10_open.yaml`:
```yaml
params:
  cash_splits: 10          # 修改资金分份数
  hot_top_n: 10            # 修改人气榜范围
  rank_threshold: 50       # 修改人气阈值
```

---

**报告生成时间**: 2026-01-05 22:30  
**策略版本**: v1.0.0  
**配置哈希**: 02ce30f3
