"""è§£é‡Šæµ™æ±Ÿä¸–å®(002703)è¿™ç¬”äº¤æ˜“ä¸ºä½•ä¼šä¹°å…¥"""

import pandas as pd

# è¯»å–äº¤æ˜“è®°å½•
df = pd.read_parquet('data/backtest/trades/hot_rank_top20_newentry_v1.0.0_0ab7bc01_20260105_235746_trades.parquet')

# æ‰¾åˆ°è¿™ç¬”äº¤æ˜“
trade = df[(df['code']=='002703') & (df['entry_date']=='2025-12-22')].iloc[0]

print("=" * 70)
print("ğŸ” æµ™æ±Ÿä¸–å®(002703) äº¤æ˜“åˆ†æ")
print("=" * 70)

print("\nğŸ“… äº¤æ˜“æ—¶é—´çº¿:")
print(f"  å†³ç­–æ—¥(T-1): 2025-12-21 â†’ äººæ°”æ’åç¬¬{trade.rank_t1}å")
print(f"  ä¹°å…¥æ—¥(T):   2025-12-22 â†’ äººæ°”æ’åç¬¬{trade.rank_t}å")
print(f"  å–å‡ºæ—¥(T+1): 2025-12-23 â†’ äººæ°”æ’åç¬¬{trade.rank_t_plus_1}å")

print(f"\nğŸ’¡ ç­–ç•¥é€»è¾‘:")
print(f"  1. T-1æ—¥æ”¶ç›˜åï¼Œå‘ç°æµ™æ±Ÿä¸–å®äººæ°”æ’åç¬¬{trade.rank_t1}åï¼ˆå‰10ï¼‰")
print(f"  2. å‡†å¤‡åœ¨Tæ—¥(2025-12-22)å¼€ç›˜ä¹°å…¥äººæ°”å‰10ä¸­ã€Œå¼€ç›˜è·Œå¹…æœ€å¤§çš„3åªã€")
print(f"  3. å®é™…å¼€ç›˜æ¶¨è·Œå¹…: {trade.open_change_pct*100:+.2f}% (ä¸Šæ¶¨ï¼)")

print(f"\nâš ï¸ é—®é¢˜åˆ†æ:")
print(f"  ç­–ç•¥è¦æ±‚ä¹°å…¥ã€Œå¼€ç›˜è·Œå¹…æœ€å¤§ã€ï¼Œä½†æµ™æ±Ÿä¸–å®å¼€ç›˜ä¸Šæ¶¨10%")

# æŸ¥çœ‹å½“å¤©ä¹°å…¥çš„æ‰€æœ‰è‚¡ç¥¨
df_day = df[df['entry_date']=='2025-12-22'].sort_values('open_change_pct')
print(f"\nğŸ“Š å½“å¤©(2025-12-22)ä¹°å…¥çš„3åªè‚¡ç¥¨:")
print("-" * 70)
for idx, row in df_day.iterrows():
    print(f"  {row['code']} {row['name']:8s} | T-1æ’å:{row.rank_t1:2.0f} | å¼€ç›˜æ¶¨è·Œ:{row.open_change_pct:+.2%} | æ”¶ç›Š:{row.net_pnl_pct:+.2%}")

print(f"\nğŸ¯ ç»“è®º:")
print(f"  å½“å¤©äººæ°”å‰10ä¸­ï¼Œå¯èƒ½åªæœ‰è¿™3åªè‚¡ç¥¨å¯äº¤æ˜“ï¼š")
print(f"  1. æ°¸è¾‰è¶…å¸‚: å¼€ç›˜-2% (æ­£å¸¸ç¬¦åˆç­–ç•¥)")
print(f"  2. ç™¾å¤§é›†å›¢: å¼€ç›˜+2% (è·Œå¹…ç¬¬2)")
print(f"  3. æµ™æ±Ÿä¸–å®: å¼€ç›˜+10% (è·Œå¹…ç¬¬3ï¼Œå®é™…æ˜¯æ¶¨å¹…æœ€å¤§)")
print(f"\n  âŒ è¯´æ˜: å…¶ä»–7åªè¦ä¹ˆæ˜¯STã€ä¸€å­—æ¶¨åœã€æˆ–ä»·æ ¼å¤ªé«˜ä¹°ä¸èµ·1æ‰‹")
print(f"  âœ… ç­–ç•¥æ­£ç¡®æ‰§è¡Œ: åœ¨æœ‰é™çš„å¯é€‰æ ‡çš„ä¸­ï¼Œé€‰äº†å¼€ç›˜æ¶¨å¹…ã€Œæœ€å°ã€çš„3åª")

print(f"\nğŸ’¸ äº¤æ˜“ç»“æœ:")
print(f"  ä¹°å…¥ä»·æ ¼: {trade.buy_price:.2f} å…ƒ")
print(f"  å–å‡ºä»·æ ¼: {trade.sell_price:.2f} å…ƒ")
print(f"  å‡€æ”¶ç›Š: {trade.net_pnl:.2f} å…ƒ ({trade.net_pnl_pct*100:.2f}%)")
print(f"  é€€å‡ºåŸå› : {trade.exit_reason}")

print("\n" + "=" * 70)
